<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sqisoft.com.mapper.SiteMapper">

	<resultMap type="sqisoft.com.model.SiteInfo" id="siteInfoMap">
		<id column="SITE_SEQ" property="siteSeq" />
		<id column="CUST_SEQ" property="custSeq" />
		<id column="SITE_NM" property="siteNm" />
		<id column="LAT" property="lat" />
		<id column="LNG" property="lng" />
		<id column="ZIPCD" property="zipCd" />		
		<id column="ADDR" property="addr" />
		<id column="ADDR_ADT" property="addrAdt" />
		<id column="DST_NM" property="dstNm" />
		<id column="DST_CD" property="dstCd" />
		<id column="RMRK" property="rmrk" />		
	</resultMap>
	
	<!-- 전체 사이트 리스트 조회 -->
	<select id="selectAdminSiteList" parameterType="sqisoft.com.model.UsrInfo" resultMap="siteInfoMap">
	    SELECT A.SITE_SEQ,
			       A.CUST_SEQ,
				   A.SITE_NM,
				   A.LAT,
				   A.LNG,
				   A.ZIPCD,
				   A.ADDR,
				   A.ADDR_ADT,
				   A.DST_NM,
				   A.DST_CD,
				   A.RMRK
			FROM REMS.SITE_INF A
	</select>
	
	<!-- 사용자 사이트 리스트 조회 -->
	<select id="selectUsrSiteList" parameterType="sqisoft.com.model.UsrInfo" resultMap="siteInfoMap">
	    SELECT A.SITE_SEQ,
			       A.CUST_SEQ,
				   A.SITE_NM,
				   A.LAT,
				   A.LNG,
				   A.ZIPCD,
				   A.ADDR,
				   A.ADDR_ADT,
				   A.DST_NM,
				   A.DST_CD,
				   A.RMRK
			FROM REMS.SITE_INF A
			LEFT OUTER JOIN REMS.USR_SITE_REL B ON A.SITE_SEQ = B.SITE_SEQ
			LEFT OUTER JOIN REMS.GRP_SITE_REL C ON A.SITE_SEQ = C.SITE_SEQ
			LEFT OUTER JOIN REMS.USR_INF D ON B.USR_ID = D.USR_ID
			LEFT OUTER JOIN REMS.USR_INF E ON C.GRP_SEQ = E.GRP_SEQ
			
			WHERE D.USR_ID = #{usrId} or E.USR_ID = #{usrId}
			
			GROUP BY A.SITE_SEQ,
			       A.CUST_SEQ,
				   A.SITE_NM,
				   A.LAT,
				   A.LNG,
				   A.ZIPCD,
				   A.ADDR,
				   A.ADDR_ADT,
				   A.DST_NM,
				   A.DST_CD,
				   A.RMRK
	</select>
		
</mapper>